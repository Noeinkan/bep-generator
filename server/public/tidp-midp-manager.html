<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIDP/MIDP Manager</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/esm/lucide-react.js" type="module"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple icon components (since lucide-react might not load properly in this context)
        const PlusIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
        );

        const CalendarIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const UsersIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
            </svg>
        );

        const DownloadIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        const TIDPMIDPManager = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [tidps, setTidps] = useState([]);
            const [midps, setMidps] = useState([]);
            const [loading, setLoading] = useState(false);
            const [showTidpForm, setShowTidpForm] = useState(false);
            const [showMidpForm, setShowMidpForm] = useState(false);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                setLoading(true);
                try {
                    const [tidpResponse, midpResponse] = await Promise.all([
                        axios.get('/api/tidp'),
                        axios.get('/api/midp')
                    ]);
                    setTidps(tidpResponse.data.tidps || []);
                    setMidps(midpResponse.data.midps || []);
                } catch (error) {
                    console.error('Failed to load data:', error);
                } finally {
                    setLoading(false);
                }
            };

            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold text-gray-900 mb-6">TIDP/MIDP Dashboard</h2>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div className="bg-blue-50 rounded-lg p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h3 className="text-lg font-semibold text-blue-900">TIDPs</h3>
                                        <p className="text-3xl font-bold text-blue-600">{tidps.length}</p>
                                    </div>
                                    <UsersIcon />
                                </div>
                                <p className="text-blue-700 text-sm mt-2">Task Information Delivery Plans</p>
                            </div>

                            <div className="bg-green-50 rounded-lg p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h3 className="text-lg font-semibold text-green-900">MIDPs</h3>
                                        <p className="text-3xl font-bold text-green-600">{midps.length}</p>
                                    </div>
                                    <CalendarIcon />
                                </div>
                                <p className="text-green-700 text-sm mt-2">Master Information Delivery Plans</p>
                            </div>

                            <div className="bg-purple-50 rounded-lg p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h3 className="text-lg font-semibold text-purple-900">Projects</h3>
                                        <p className="text-3xl font-bold text-purple-600">1</p>
                                    </div>
                                    <CalendarIcon />
                                </div>
                                <p className="text-purple-700 text-sm mt-2">Active Projects</p>
                            </div>
                        </div>

                        <div className="flex space-x-4">
                            <button
                                onClick={() => setShowTidpForm(true)}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"
                            >
                                <PlusIcon />
                                <span>Create New TIDP</span>
                            </button>
                            <button
                                onClick={() => setShowMidpForm(true)}
                                className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"
                            >
                                <PlusIcon />
                                <span>Create New MIDP</span>
                            </button>
                        </div>
                    </div>
                </div>
            );

            const TIDPList = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-900">Task Information Delivery Plans</h2>
                            <button
                                onClick={() => setShowTidpForm(true)}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors"
                            >
                                <PlusIcon />
                                <span>New TIDP</span>
                            </button>
                        </div>

                        {tidps.length === 0 ? (
                            <div className="text-center py-12 text-gray-500">
                                <UsersIcon className="w-12 h-12 mx-auto mb-4 text-gray-400" />
                                <p className="text-lg">No TIDPs created yet</p>
                                <p className="text-sm">Create your first Task Information Delivery Plan</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {tidps.map((tidp, index) => (
                                    <div key={index} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <h3 className="font-semibold text-gray-900 mb-2">TIDP {index + 1}</h3>
                                        <p className="text-gray-600 text-sm mb-3">Sample TIDP Description</p>
                                        <div className="flex space-x-2">
                                            <button className="flex-1 bg-blue-50 text-blue-700 py-2 px-3 rounded text-sm hover:bg-blue-100 transition-colors">
                                                View
                                            </button>
                                            <button className="bg-gray-50 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-100 transition-colors">
                                                <DownloadIcon />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            const MIDPList = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-900">Master Information Delivery Plans</h2>
                            <button
                                onClick={() => setShowMidpForm(true)}
                                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors"
                            >
                                <PlusIcon />
                                <span>New MIDP</span>
                            </button>
                        </div>

                        {midps.length === 0 ? (
                            <div className="text-center py-12 text-gray-500">
                                <CalendarIcon className="w-12 h-12 mx-auto mb-4 text-gray-400" />
                                <p className="text-lg">No MIDPs created yet</p>
                                <p className="text-sm">Create your first Master Information Delivery Plan</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {midps.map((midp, index) => (
                                    <div key={index} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <h3 className="font-semibold text-gray-900 mb-2">MIDP {index + 1}</h3>
                                        <p className="text-gray-600 text-sm mb-3">Sample MIDP Description</p>
                                        <div className="flex space-x-2">
                                            <button className="flex-1 bg-green-50 text-green-700 py-2 px-3 rounded text-sm hover:bg-green-100 transition-colors">
                                                View
                                            </button>
                                            <button className="bg-gray-50 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-100 transition-colors">
                                                <DownloadIcon />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            const TIDPForm = () => {
                const [tidpData, setTidpData] = useState({
                    taskTeam: '',
                    discipline: '',
                    teamLeader: '',
                    description: '',
                    containers: [
                        {
                            id: 'c-' + Date.now(),
                            'Container Name': 'Initial deliverable',
                            'Type': 'Model',
                            'Format': 'IFC',
                            'LOI Level': 'LOD 300',
                            'Author': '',
                            'Dependencies': [],
                            'Est. Time': '1 day',
                            'Milestone': 'Initial',
                            'Due Date': new Date().toISOString().slice(0,10),
                            'Status': 'Planned'
                        }
                    ]
                });

                const addContainer = () => {
                    const newContainer = {
                        id: 'c-' + Date.now(),
                        'Container Name': '',
                        'Type': 'Model',
                        'Format': 'IFC',
                        'LOI Level': 'LOD 200',
                        'Author': '',
                        'Dependencies': [],
                        'Est. Time': '1 day',
                        'Milestone': '',
                        'Due Date': '',
                        'Status': 'Planned'
                    };
                    setTidpData(prev => ({
                        ...prev,
                        containers: [...prev.containers, newContainer]
                    }));
                };

                const updateContainer = (index, field, value) => {
                    setTidpData(prev => ({
                        ...prev,
                        containers: prev.containers.map((container, i) =>
                            i === index ? { ...container, [field]: value } : container
                        )
                    }));
                };

                const removeContainer = (index) => {
                    setTidpData(prev => ({
                        ...prev,
                        containers: prev.containers.filter((_, i) => i !== index)
                    }));
                };

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    try {
                        const payload = {
                            teamName: tidpData.taskTeam,
                            discipline: tidpData.discipline,
                            leader: tidpData.teamLeader,
                            company: 'TBD',
                            responsibilities: tidpData.description || 'TBD',
                            description: tidpData.description,
                            containers: tidpData.containers
                        };
                        await axios.post('/api/tidp', payload);
                        alert('TIDP created successfully!');
                        setShowTidpForm(false);
                        loadData();
                    } catch (error) {
                        console.error('Failed to create TIDP:', error);
                        alert('Failed to create TIDP: ' + (error.response?.data?.error || error.message));
                    }
                };

                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold text-gray-900">Create New TIDP</h2>
                                <button
                                    onClick={() => setShowTidpForm(false)}
                                    className="text-gray-500 hover:text-gray-700"
                                >
                                    ✕
                                </button>
                            </div>

                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Task Team</label>
                                        <input
                                            type="text"
                                            value={tidpData.taskTeam}
                                            onChange={(e) => setTidpData(prev => ({ ...prev, taskTeam: e.target.value }))}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Architecture Team"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Discipline</label>
                                        <select
                                            value={tidpData.discipline}
                                            onChange={(e) => setTidpData(prev => ({ ...prev, discipline: e.target.value }))}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            required
                                        >
                                            <option value="">Select Discipline</option>
                                            <option value="architecture">Architecture</option>
                                            <option value="structural">Structural Engineering</option>
                                            <option value="mep">MEP Engineering</option>
                                            <option value="civil">Civil Engineering</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Team Leader</label>
                                        <input
                                            type="text"
                                            value={tidpData.teamLeader}
                                            onChange={(e) => setTidpData(prev => ({ ...prev, teamLeader: e.target.value }))}
                                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="John Smith"
                                            required
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea
                                        rows={4}
                                        value={tidpData.description}
                                        onChange={(e) => setTidpData(prev => ({ ...prev, description: e.target.value }))}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Describe the task information delivery plan..."
                                    />
                                </div>

                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-lg font-semibold text-gray-900">Information Containers</h3>
                                        <button
                                            type="button"
                                            onClick={addContainer}
                                            className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
                                        >
                                            <PlusIcon />
                                            <span>Add Container</span>
                                        </button>
                                    </div>

                                    <div className="overflow-x-auto">
                                        <table className="min-w-full border border-gray-300 rounded-lg">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Container Name</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Type</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Format</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">LOI Level</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Author</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Est. Time</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Milestone</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Due Date</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Status</th>
                                                    <th className="px-4 py-2 text-left text-sm font-medium text-gray-700 border-b">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {tidpData.containers.map((container, index) => (
                                                    <tr key={container.id} className="border-b">
                                                        <td className="px-4 py-2">
                                                            <input
                                                                type="text"
                                                                value={container['Container Name']}
                                                                onChange={(e) => updateContainer(index, 'Container Name', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                                placeholder="Federated Model"
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <select
                                                                value={container['Type']}
                                                                onChange={(e) => updateContainer(index, 'Type', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                            >
                                                                <option value="Model">Model</option>
                                                                <option value="Drawing">Drawing</option>
                                                                <option value="Document">Document</option>
                                                                <option value="Report">Report</option>
                                                            </select>
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <select
                                                                value={container['Format']}
                                                                onChange={(e) => updateContainer(index, 'Format', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                            >
                                                                <option value="IFC">IFC</option>
                                                                <option value="DWG">DWG</option>
                                                                <option value="PDF">PDF</option>
                                                                <option value="XLSX">XLSX</option>
                                                            </select>
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <select
                                                                value={container['LOI Level']}
                                                                onChange={(e) => updateContainer(index, 'LOI Level', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                            >
                                                                <option value="LOD 100">LOD 100</option>
                                                                <option value="LOD 200">LOD 200</option>
                                                                <option value="LOD 300">LOD 300</option>
                                                                <option value="LOD 350">LOD 350</option>
                                                                <option value="LOD 400">LOD 400</option>
                                                            </select>
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <input
                                                                type="text"
                                                                value={container['Author']}
                                                                onChange={(e) => updateContainer(index, 'Author', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                                placeholder="John Smith"
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <input
                                                                type="text"
                                                                value={container['Est. Time']}
                                                                onChange={(e) => updateContainer(index, 'Est. Time', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                                placeholder="2 days"
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <input
                                                                type="text"
                                                                value={container['Milestone']}
                                                                onChange={(e) => updateContainer(index, 'Milestone', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                                placeholder="Stage 3"
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <input
                                                                type="date"
                                                                value={container['Due Date']}
                                                                onChange={(e) => updateContainer(index, 'Due Date', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                            />
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <select
                                                                value={container['Status']}
                                                                onChange={(e) => updateContainer(index, 'Status', e.target.value)}
                                                                className="w-full p-2 border border-gray-300 rounded"
                                                            >
                                                                <option value="Planned">Planned</option>
                                                                <option value="In Progress">In Progress</option>
                                                                <option value="Completed">Completed</option>
                                                                <option value="Delayed">Delayed</option>
                                                            </select>
                                                        </td>
                                                        <td className="px-4 py-2">
                                                            <button
                                                                type="button"
                                                                onClick={() => removeContainer(index)}
                                                                className="text-red-600 hover:text-red-800"
                                                                disabled={tidpData.containers.length === 1}
                                                            >
                                                                Remove
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="flex space-x-4">
                                    <button
                                        type="submit"
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors"
                                    >
                                        Create TIDP
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => setShowTidpForm(false)}
                                        className="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const MIDPForm = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-900">Create New MIDP</h2>
                            <button
                                onClick={() => setShowMidpForm(false)}
                                className="text-gray-500 hover:text-gray-700"
                            >
                                ✕
                            </button>
                        </div>

                        <form className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                                <input
                                    type="text"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    placeholder="Office Complex Project"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Version</label>
                                <input
                                    type="text"
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    placeholder="1.0"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea
                                    rows={4}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    placeholder="Describe the master information delivery plan..."
                                />
                            </div>

                            <div className="flex space-x-4">
                                <button
                                    type="submit"
                                    className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors"
                                >
                                    Create MIDP
                                </button>
                                <button
                                    type="button"
                                    onClick={() => setShowMidpForm(false)}
                                    className="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );

            if (showTidpForm) return <TIDPForm />;
            if (showMidpForm) return <MIDPForm />;

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <h1 className="text-2xl font-bold text-gray-900">TIDP/MIDP Manager</h1>
                            <p className="text-gray-600">Manage Task and Master Information Delivery Plans</p>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 py-8">
                        <div className="mb-6">
                            <nav className="flex space-x-8">
                                {[
                                    { id: 'dashboard', label: 'Dashboard' },
                                    { id: 'tidps', label: 'TIDPs' },
                                    { id: 'midps', label: 'MIDPs' }
                                ].map(({ id, label }) => (
                                    <button
                                        key={id}
                                        onClick={() => setActiveTab(id)}
                                        className={`py-2 px-1 border-b-2 font-medium text-sm ${
                                            activeTab === id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        {label}
                                    </button>
                                ))}
                            </nav>
                        </div>

                        {loading ? (
                            <div className="text-center py-12">
                                <p className="text-gray-500">Loading...</p>
                            </div>
                        ) : (
                            <>
                                {activeTab === 'dashboard' && <Dashboard />}
                                {activeTab === 'tidps' && <TIDPList />}
                                {activeTab === 'midps' && <MIDPList />}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TIDPMIDPManager />, document.getElementById('root'));
    </script>
</body>
</html>